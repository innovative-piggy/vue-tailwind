const prefetcher=document.createElement("link"),isSupported=prefetcher.relList&&prefetcher.relList.supports&&prefetcher.relList.supports("prefetch"),isDataSaverEnabled=navigator.connection&&navigator.connection.saveData;export default{lastTouchTimestamp:void 0,mouseoverTimer:void 0,urlToPreload:void 0,finalOptions:{delayOnHover:65,useMousedown:!1,useMousedownOnly:!1,allowQueryString:!1,allowExternalLinks:!1,useWhitelist:!1},install(e,t){isSupported&&!isDataSaverEnabled&&(this.finalOptions=Object.assign(this.finalOptions,t),this.buildPrefetcher(),this.initializeEventListeners())},buildPrefetcher(){prefetcher.rel="prefetch",document.head.appendChild(prefetcher)},initializeEventListeners(){const e={capture:!0,passive:!0};this.finalOptions.useMousedownOnly||document.addEventListener("touchstart",this.touchstartListener.bind(this),e),this.finalOptions.useMousedown?document.addEventListener("mousedown",this.mousedownListener.bind(this),e):document.addEventListener("mouseover",this.mouseoverListener.bind(this),e)},touchstartListener(e){this.lastTouchTimestamp=performance.now();const t=e.target.closest("a");this.isPreloadable(t)&&(t.addEventListener("touchcancel",this.touchendAndTouchcancelListener.bind(this),{passive:!0}),t.addEventListener("touchend",this.touchendAndTouchcancelListener.bind(this),{passive:!0}),this.urlToPreload=t.href,this.preload(t.href))},touchendAndTouchcancelListener(){this.urlToPreload=void 0,this.stopPreloading()},mouseoverListener(e){if(performance.now()-this.lastTouchTimestamp<1100)return;const t=e.target.closest("a");this.isPreloadable(t)&&(t.addEventListener("mouseout",this.mouseoutListener.bind(this),{passive:!0}),this.urlToPreload=t.href,this.mouseoverTimer=setTimeout(()=>{this.preload(t.href),this.mouseoverTimer=void 0},this.finalOptions.delayOnHover))},mousedownListener(e){const t=e.target.closest("a");this.isPreloadable(t)&&(t.addEventListener("mouseout",this.mouseoutListener.bind(this),{passive:!0}),this.urlToPreload=t.href,this.preload(t.href))},mouseoutListener(e){e.relatedTarget&&e.target.closest("a")===e.relatedTarget.closest("a")||(this.mouseoverTimer&&(clearTimeout(this.mouseoverTimer),this.mouseoverTimer=void 0),this.urlToPreload=void 0,this.stopPreloading())},isPreloadable(e){return!(!e||!e.href)&&(this.urlToPreload!==e.href&&((!this.useWhitelist||"instant"in e.dataset)&&(!(!this.allowExternalLinks&&e.origin!==location.origin&&!("instant"in e.dataset))&&(!!["http:","https:"].includes(e.protocol)&&(("http:"!==e.protocol||"https:"!==location.protocol)&&(!(!this.allowQueryString&&e.search&&!("instant"in e.dataset))&&((!e.hash||e.pathname+e.search!==location.pathname+location.search)&&!("noInstant"in e.dataset))))))))},preload(e){prefetcher.href=e},stopPreloading(){prefetcher.removeAttribute("href")}};
